.. -*- mode: rst -*-


Спајање и груписање
...................

.. questionnote::
                
   Приказати просечне оцене из свих предмета из првог разреда.

Јасно је да је потребно извршити груписање оцена из табеле оцена на
основу предмета (тј. њихових идентификатора) и затим израчунати
статистику (аритметичку средину) за сваку групу посебно. Проблем је то
што се захтева филтрирање предмета тако да се прикажу само просечне
оцене за предмете из првог разреда, међутим, подаци о разреду у ком се
предмет предаје се не налази у табели оцена, већ у табели
предмета. Стога је пре класичног груписања и израчунавања статистика
по групама потребно спојити табелу оцена и табелу предмета.
   
.. code-block:: sql

   SELECT naziv, round(AVG(ocena), 2) AS prosek
   FROM ocena
        JOIN predmet on ocena.id_predmet = predmet.id
   WHERE razred = 1
   GROUP BY predmet.id;

Извршавањем упита добија се следећи резултат:

.. csv-table::
   :header:  "naziv", "prosek"

   Математика, 3.1
   Српски језик, 3.74
   Рачунарство и информатика, 3.39

.. questionnote::

   Приказати просечне оцене из свих предмета (уређене опадајуће по
   просечној оцени).

Овај упит је сличан претходном. Када бисмо се задовољили приказом
просечних оцена и идентификатора предмета, тада бисмо могли применити
само груписање и израчунавање просека група из табеле са
оценама. Међутим, пошто желимо да прикажемо називе предмета, а подаци
о њима се налазе у табели предмета, вршимо спајање две табеле.
   
.. code-block:: sql
                
   SELECT naziv, round(AVG(ocena), 2) AS prosek
   FROM ocena
        JOIN predmet on ocena.id_predmet = predmet.id
   GROUP BY predmet.id
   ORDER BY prosek DESC;

Извршавањем упита добија се следећи резултат:

.. csv-table::
   :header:  "naziv", "prosek"

   Српски језик, 3.74
   Рачунарство и информатика, 3.39
   Математика, 3.1

Могуће је користити и клаузулу ``HAVING`` (подсетимо се, она служи за
филтрирање након груписања на основу израчунатих вредности статистика
група).
   
.. questionnote::
   
   Приказати називе предмета и просечне оцене на писменим задацима за
   све предмете код којих је просечна оцена на писменим задацима бар
   3,50.

.. code-block:: sql
                
   SELECT naziv, round(AVG(ocena), 2) AS prosek
   FROM ocena
        JOIN predmet ON ocena.id_predmet = predmet.id
   WHERE ocena.vrsta = 'писмени задатак'
   GROUP BY predmet.id
   HAVING prosek >= 3.50;

Извршавањем упита добија се следећи резултат:

.. csv-table::
   :header:  "naziv", "prosek"

   Српски језик, 3.98

